# **安装和配置计算节点**

## 1, 安装相关软件

```shell
yum install openstack-nova-compute -y
```

## 2, 修改配置 文件   /etc/nova/nova.conf

```shell
vim nova

openstack-config  --set /etc/nova/nova.conf DEFAULT rpc_backend rabbit
openstack-config  --set /etc/nova/nova.conf DEFAULT auth_strategy keystone
openstack-config  --set /etc/nova/nova.conf DEFAULT my_ip 10.0.0.31
openstack-config  --set /etc/nova/nova.conf DEFAULT use_neutron True
openstack-config  --set /etc/nova/nova.conf DEFAULT firewall_driver nova.virt.firewall.NoopFirewallDriver
openstack-config  --set /etc/nova/nova.conf oslo_messaging_rabbit rabbit_host controller
openstack-config  --set /etc/nova/nova.conf oslo_messaging_rabbit rabbit_userid openstack
openstack-config  --set /etc/nova/nova.conf oslo_messaging_rabbit rabbit_password RABBIT_PASS
openstack-config  --set /etc/nova/nova.conf keystone_authtoken auth_uri http://controller:5000
openstack-config  --set /etc/nova/nova.conf keystone_authtoken auth_url http://controller:35357
openstack-config  --set /etc/nova/nova.conf keystone_authtoken memcached_servers controller:11211
openstack-config  --set /etc/nova/nova.conf keystone_authtoken auth_type password
openstack-config  --set /etc/nova/nova.conf keystone_authtoken project_domain_name default
openstack-config  --set /etc/nova/nova.conf keystone_authtoken user_domain_name default
openstack-config  --set /etc/nova/nova.conf keystone_authtoken project_name service
openstack-config  --set /etc/nova/nova.conf keystone_authtoken username nova
openstack-config  --set /etc/nova/nova.conf keystone_authtoken password NOVA_PASS
openstack-config  --set /etc/nova/nova.conf vnc enabled True
openstack-config  --set /etc/nova/nova.conf vnc vncserver_listen 0.0.0.0
openstack-config  --set /etc/nova/nova.conf vnc vncserver_proxyclient_address '$my_ip'
openstack-config  --set /etc/nova/nova.conf vnc novncproxy_base_url http://controller:6080/vnc_auto.html
openstack-config  --set /etc/nova/nova.conf glance api_servers http://controller:9292 
openstack-config  --set /etc/nova/nova.conf oslo_concurrency lock_path /var/lib/nova/tmp
```

```shell
sh   nova
```

## 完成安装

1. 确定您的计算节点是否支持虚拟机的硬件加速。

   ```
    egrep -c '(vmx|svm)' /proc/cpuinfo
   ```

   如果这个命令返回了 `one or greater` 的值，那么你的计算节点支持硬件加速且不需要额外的配置。

   如果这个命令返回了 `zero` 值，那么你的计算节点不支持硬件加速。你必须配置 `libvirt` 来使用 QEMU 去代替 KVM

   在 `/etc/nova/nova.conf` 文件的 `[libvirt]` 区域做出如下的编辑：

   ```
   [libvirt]
   ...
   virt_type = qemu
   cpu_mode = none
   ```

```shell
 systemctl restart openstack-nova-compute.service 
```



## 启动计算服务及其依赖，并将其配置为随系统自动启动：



```shell
systemctl start libvirtd.service openstack-nova-compute.service
systemctl enable libvirtd.service openstack-nova-compute.service
```





## 检查

```shell
[root@controller ~]# nova service-list 
+----+------------------+------------+----------+---------+-------+----------------------------+-----------------+
| Id | Binary           | Host       | Zone     | Status  | State | Updated_at                 | Disabled Reason |
+----+------------------+------------+----------+---------+-------+----------------------------+-----------------+
| 1  | nova-conductor   | controller | internal | enabled | up    | 2021-09-06T05:33:05.000000 | -               |
| 2  | nova-consoleauth | controller | internal | enabled | up    | 2021-09-06T05:33:05.000000 | -               |
| 4  | nova-scheduler   | controller | internal | enabled | up    | 2021-09-06T05:33:05.000000 | -               |
| 8  | nova-compute     | compute1   | nova     | enabled | up    | 2021-09-06T05:32:59.000000 | -               |
+----+------------------+------------+----------+---------+-------+----------------------------+-----------------+
```



